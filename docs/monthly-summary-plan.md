# プラン：月次収支サマリー画面

## 1. 目的

指定した月の全口座における収支状況（総収入、総支出、差引）と、口座ごとの収支内訳を、スマートフォンの限られた画面で直感的に把握できるUI/UXを提供する。

## 2. データ要件と準備

*   **データ取得:**
    *   ユーザーに紐づく全`Account`情報を取得します。
    *   選択された月に基づき、関連する`OneTimeTransaction`（`transaction_date`が月内）と`RecurringTransaction`（`day_of_month`が月内に該当）を取得します。
*   **データ集計（都度計算）:**
    *   取得したトランザクションデータを基に、以下の値を計算します。
        *   **月全体の合計:** 総収入、総支出、差引（収入 - 支出）
        *   **口座ごと:** 口座別収入合計、口座別支出合計
*   **データモデルの提案（将来的な拡張性のため）:**
    *   `types/database.ts` の `Account` 型に `account_type: 'bank' | 'credit_card' | 'e-money' | 'investment' | 'other'` のようなフィールドを追加することを推奨します。これにより、将来的に口座種別でのフィルタリングやグルーピングが可能になります。（V1ではUI上必須ではありません）
    *   `OneTimeTransaction` と `RecurringTransaction` 型に `category: string` (またはより具体的な型) フィールドを追加することを推奨します。これにより、正確なカテゴリ別集計が可能になります。（V1ではUI上必須ではありませんが、カテゴリ表示機能の実現に必要です）

## 3. UI/UX デザイン案 (HeroUI優先、必要に応じて柔軟に対応)

**画面構成:**

```mermaid
graph TD
    A[画面全体: 月次サマリー] --> B(ヘッダー);
    A --> C(口座別サマリーリスト);

    subgraph B [ヘッダー]
        direction LR
        B1(前月ボタン) --> B2(年月表示);
        B2 --> B3(翌月ボタン);
        B4(月次合計) -- 総収入 --> B5(値);
        B4 -- 総支出 --> B6(値);
        B4 -- 差引 --> B7(値);
    end

    subgraph C [口座別サマリーリスト]
        direction TB
        C1(口座カード 1) --> C2(口座カード 2);
        C2 --> C3(...);
    end

    subgraph C1 [口座カード (例: Sales)]
        direction TB
        C1a(口座名: Sales) --> C1b(月次収支);
        C1b -- 収入 --> C1c(値);
        C1b -- 支出 --> C1d(値);
        C1e(タップで詳細へ)
    end

```

**詳細:**

*   **ヘッダー:**
    *   **年月表示:** 現在表示している月を表示 (例: "2025年 5月")。
    *   **月移動:** 左右の矢印ボタン `<` `>` で前月/翌月に移動。
    *   **月次合計:**
        *   「総収入」「総支出」「差引」のラベルと共に、計算された金額を大きく分かりやすく表示。差引額は色分け（黒字は緑、赤字は赤など）するとより直感的です。
        *   HeroUIの `Card` や `Stat` コンポーネント、またはカスタムレイアウトで実装。
*   **口座別サマリーリスト:**
    *   各口座の情報をリスト形式（またはカード形式）で縦に並べます。横スクロールは発生させません。
    *   **各リスト項目（口座カード）:**
        *   **口座名:** `Account.name` を表示。（将来的に `account_type` をアイコンなどで表現することも検討可）
        *   **月次収支:** その口座の「収入合計」「支出合計」をラベルと共に表示。
        *   **インタラクション:** 各口座の項目全体をタップ可能にし、タップするとその口座の該当月の取引明細一覧画面へ遷移（ドリルダウン）。
        *   HeroUIの `Card`, `List`, `ListItem` などのコンポーネントを組み合わせて実装。
*   **カテゴリ別支出概要 (Optional V2):**
    *   もし `category` フィールドが実装されれば、全支出に対するカテゴリ別割合をシンプルな棒グラフやリスト形式で表示するセクションを追加できます。
    *   HeroUIに適切なグラフコンポーネントがない場合、軽量なグラフライブラリ（例: Recharts, Chart.js）の導入を検討します。
*   **デザイン:**
    *   HeroUIのデザイントークン（色、スペース、タイポグラフィ）を活用し、全体的にシンプルでクリーンなデザインを目指します。
    *   重要な数字（合計額、差引額など）が目立つように、フォントサイズや色で強調します。

## 4. 実装ステップ（高レベル）

1.  **データ取得ロジック:** Supabaseクライアントを使用し、選択された月に基づいてアカウントとトランザクションを取得し、収支を集計するサーバーアクション (`app/actions.ts` など) またはAPIルートを作成します。
2.  **UIコンポーネント作成:**
    *   月次サマリー画面のメインとなるReact Server Component (`app/(protected)/summary/page.tsx` など) を作成します。
    *   ヘッダー部分（月選択、全体サマリー）のコンポーネントを作成します。状態管理（選択月）には `useState` やURLパラメータを使用します。
    *   口座別サマリーリストを表示するコンポーネントを作成し、取得したデータを基に口座カードをループ描画します。
    *   口座カードコンポーネントを作成します。
3.  **ルーティング/ナビゲーション:** 口座カードタップ時のドリルダウン先となる取引明細画面へのルーティングを設定します (Next.js App Router)。
4.  **(Optional V2) カテゴリ集計・表示:** カテゴリデータが利用可能になったら、集計ロジックと表示コンポーネント（グラフ含む）を追加します。
5.  **テスト:** 各機能が正しく動作するかテストします。